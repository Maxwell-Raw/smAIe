function ColorFinder(a){this.callback=a,this.getMostProminentColor=function(a){var b=null;this.callback||(this.callback=function(){return 1});var c=this.getImageData(a);return b=this.getMostProminentRGBImpl(c,6,b,this.callback),b=this.getMostProminentRGBImpl(c,4,b,this.callback),b=this.getMostProminentRGBImpl(c,2,b,this.callback),b=this.getMostProminentRGBImpl(c,0,b,this.callback)},this.getImageData=function(a,b,c,d){var e,h,i,j,k,n,f=document.createElement("canvas"),g=f.getContext&&f.getContext("2d"),l=-4;if(!g)return defaultRGB;j=f.height=a.naturalHeight||a.offsetHeight||a.height,i=f.width=a.naturalWidth||a.offsetWidth||a.width,g.drawImage(a,0,0);try{h=g.getImageData(0,0,i,j)}catch(a){return null}n=h.data.length;for(var s=Math.max(1,Math.round(n/5e3)),t={};(l+=4*s)<n;)h.data[l+3]>32&&(k=(h.data[l]>>b)+","+(h.data[l+1]>>b)+","+(h.data[l+2]>>b),t.hasOwnProperty(k)?(e=t[k],e.count++):(e={r:h.data[l],g:h.data[l+1],b:h.data[l+2],count:1},e.weight=this.callback(e.r,e.g,e.b),e.weight<=0&&(e.weight=1e-10),t[k]=e));return t},this.getMostProminentRGBImpl=function(a,b,c,d){var g,h,j,l,m,n,e={r:0,g:0,b:0,count:0,d:b},f={},o=0;for(h in a)g=a[h],totalWeight=g.weight*g.count,++o,this.doesRgbMatch(c,g.r,g.g,g.b)&&(j=(g.r>>b)+","+(g.g>>b)+","+(g.b>>b),f.hasOwnProperty(j)?f[j]+=totalWeight:f[j]=totalWeight);for(i in f)data=i.split(","),l=data[0],m=data[1],n=data[2],o=f[i],o>e.count&&(e.count=o,data=i.split(","),e.r=l,e.g=m,e.b=n);return e},this.doesRgbMatch=function(a,b,c,d){return null==a||(b>>=a.d,c>>=a.d,d>>=a.d,a.r==b&&a.g==c&&a.b==d)}}
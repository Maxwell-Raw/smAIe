!function(a){"use strict";function f(){var c=b.clientHeight,d=a.innerHeight;return c<d?d:c}function g(){return a.pageYOffset||b.scrollTop}function h(a){var b=0,c=0;do isNaN(a.offsetTop)||(b+=a.offsetTop),isNaN(a.offsetLeft)||(c+=a.offsetLeft);while(a=a.offsetParent);return{top:b,left:c}}function i(a,b){var c=a.offsetHeight,d=g(),e=d+f(),i=h(a).top,j=i+c,b=b||0;return i+c*b<=e&&j-c*b>=d}function j(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function k(a){this.el=a,this.anchor=a.querySelector("a"),this.image=a.querySelector("img"),this.desc=a.querySelector("h3")}function l(a,b){this.el=a,this.options=j({},this.options),j(this.options,b),this._init()}var b=a.document.documentElement,c={animations:Modernizr.cssanimations},d={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},e=d[Modernizr.prefixed("animation")];k.prototype.addCurtain=function(){if(this.image){this.curtain=document.createElement("div"),this.curtain.className="curtain";var a=new ColorFinder(function(b,c,d){return(Math.abs(b-c)*Math.abs(b-c)+Math.abs(b-d)*Math.abs(b-d)+Math.abs(c-d)*Math.abs(c-d))/65535*50+1}).getMostProminentColor(this.image);a.r&&a.g&&a.b&&(this.curtain.style.background="rgb("+a.r+","+a.g+","+a.b+")"),this.anchor.appendChild(this.curtain)}},k.prototype.changeAnimationDelay=function(a){this.curtain&&(this.curtain.style.WebkitAnimationDelay=a+"ms",this.curtain.style.animationDelay=a+"ms"),this.image&&(this.image.style.WebkitAnimationDelay=a+"ms",this.image.style.animationDelay=a+"ms"),this.desc&&(this.desc.style.WebkitAnimationDelay=a+"ms",this.desc.style.animationDelay=a+"ms")},l.prototype.options={minDelay:0,maxDelay:500,viewportFactor:0},l.prototype._init=function(){var b=this,c=[];[].slice.call(this.el.children).forEach(function(a,b){var d=new k(a);c.push(d)}),this.items=c,this.itemsCount=this.items.length,this.itemsRenderedCount=0,this.didScroll=!1,imagesLoaded(this.el,function(){classie.add(b.el,"loaded"),new Masonry(b.el,{itemSelector:"li",isFitWidth:!0,transitionDuration:0}),b.items.forEach(function(a){i(a.el)?(++b.itemsRenderedCount,classie.add(a.el,"shown")):(a.addCurtain(),a.changeAnimationDelay(Math.random()*(b.options.maxDelay-b.options.minDelay)+b.options.minDelay))});var c=function(){b.didScroll||(b.didScroll=!0,setTimeout(function(){b._scrollPage()},200)),b.itemsRenderedCount===b.itemsCount&&a.removeEventListener("scroll",c,!1)};a.addEventListener("scroll",c,!1),a.addEventListener("resize",function(){b._resizeHandler()},!1)})},l.prototype._scrollPage=function(){var a=this;this.items.forEach(function(b){if(!classie.has(b.el,"shown")&&!classie.has(b.el,"animate")&&i(b.el,a.options.viewportFactor)){if(++a.itemsRenderedCount,!b.curtain)return void classie.add(b.el,"shown");classie.add(b.el,"animate");var d=function(a){c.animations&&this.removeEventListener(e,d),classie.remove(b.el,"animate"),classie.add(b.el,"shown")};c.animations?b.curtain.addEventListener(e,d):d()}}),this.didScroll=!1},l.prototype._resizeHandler=function(){function b(){a._scrollPage(),a.resizeTimeout=null}var a=this;this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(b,1e3)},a.GridScrollFx=l}(window);